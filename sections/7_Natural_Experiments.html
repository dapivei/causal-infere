
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>8. Natural Experiments &#8212; Causal Inference for Data Science</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'sections/7_Natural_Experiments';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="9. The Interplay between Machine Learning and Causal Inference" href="8_ML_and_Causality.html" />
    <link rel="prev" title="7. Regression" href="6_Regression_1-2.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Causal Inference for Data Science - Home"/>
    <img src="../_static/logo.png" class="logo__image only-dark pst-js-only" alt="Causal Inference for Data Science - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome to Causal Inference
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="1_Introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="2_Probability_1-2.html">2. Probability</a></li>
<li class="toctree-l1"><a class="reference internal" href="3_Probability_Statistics.html">3. Probability, All Causes Model and Statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="4_Statistics_and_Experiments.html">4. Hypothesis testing and Introduction to Experiments</a></li>

<li class="toctree-l1"><a class="reference internal" href="5_Experiments.html">6. Experiments (Cont.)</a></li>
<li class="toctree-l1"><a class="reference internal" href="6_Regression_1-2.html">7. Regression</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">8. Natural Experiments</a></li>
<li class="toctree-l1"><a class="reference internal" href="8_ML_and_Causality.html">9. The Interplay between Machine Learning and Causal Inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="9_Matching.html">10. Matching</a></li>
<li class="toctree-l1"><a class="reference internal" href="10_Instruments.html">11. Instrumental Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="11_Instruments_RDD.html">12. Instrumental Variables(Continued)</a></li>
<li class="toctree-l1"><a class="reference internal" href="12_RDD.html">13. Instrumental Variables (Continued) and Intro to Regression Discontinuity (RDD)</a></li>





<li class="toctree-l1"><a class="reference internal" href="13_Difference_in_Differences.html">19. Difference in Differences</a></li>
<li class="toctree-l1"><a class="reference internal" href="14_Review.html">20. Final Course Review</a></li>


</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fsections/7_Natural_Experiments.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/sections/7_Natural_Experiments.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Natural Experiments</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#causality-from-observational-data">8.1. Causality from Observational Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">8.2. 1. Natural Experiments</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#random-v-s-non-random-assignment">8.2.1. Random v.s. Non-random Assignment</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#case-study-dutch-postcode-lottery">8.2.2. Case Study: Dutch Postcode Lottery</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#control-variables-preview-and-review">8.3. Control Variables (Preview) and Review</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#independence-recap">8.3.1. 2.1 Independence Recap</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conditional-independence">8.3.2. 2.2 Conditional Independence</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#revisiting-revisiting-all-causes-model">8.3.3. Revisiting -  Revisiting All Causes Model</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#definition">8.3.3.1. Definition</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#simulation">8.3.3.2. 2.3.2 Simulation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#other-topics-for-midterm">8.4. 3. Other Topics for Midterm</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#good-luck-on-your-midterm-next-week">8.5. Good luck on your midterm next week!</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div align="center">
<p><a class="reference external" href="https://colab.research.google.com/github/dapivei/causal-infere/blob/main/sections/7_Natural_Experiments.ipynb"><img alt="Open in Colab" src="https://colab.research.google.com/assets/colab-badge.svg" /></a></p>
</div>
<section id="natural-experiments">
<h1><span class="section-number">8. </span>Natural Experiments<a class="headerlink" href="#natural-experiments" title="Link to this heading">#</a></h1>
<section id="causality-from-observational-data">
<h2><span class="section-number">8.1. </span>Causality from Observational Data<a class="headerlink" href="#causality-from-observational-data" title="Link to this heading">#</a></h2>
<p>Experiments / Random control trials (RCT) are often referred as the gold standards for causality. We can easily establish the important independence assumption by randomizing treatments in experiments:</p>
<div class="amsmath math notranslate nohighlight" id="equation-1dcfdbba-6754-420b-b137-b37aed8ce545">
<span class="eqno">(8.1)<a class="headerlink" href="#equation-1dcfdbba-6754-420b-b137-b37aed8ce545" title="Permalink to this equation">#</a></span>\[\begin{equation}
S \perp U
\end{equation}\]</div>
<p>However, this is not always possible, and experiments are expensive.</p>
<p>How do we learn <strong>causal</strong> insights from large amount of data that we’ve already observed and collected? e.g.,</p>
<ul class="simple">
<li><p>Electronic health records</p></li>
<li><p>Financial market performance</p></li>
<li><p>Biological sequences</p></li>
<li><p>Reddit/Twitter posts</p></li>
</ul>
<p>We did not and cannot go back in time to manipulate these data-generating processes to enforce the independence assumption, but there are still methods to infer causal effects from observational data, broadly in the following two ways:</p>
<ol class="arabic simple">
<li><p>Treatment was as-if randomly assigned (maybe for a subset of the population) - Natural Experiments</p></li>
<li><p>Adjust the treatment and control group characteristics so that they look similar - e.g., through controlling confounders</p></li>
</ol>
</section>
<section id="id1">
<h2><span class="section-number">8.2. </span>1. Natural Experiments<a class="headerlink" href="#id1" title="Link to this heading">#</a></h2>
<p>Sometimes, natural processes give us a treatment that behaves “as-if” random. This allows us to establish the experimental assumption:</p>
<div class="amsmath math notranslate nohighlight" id="equation-a8658c21-2c86-4c64-848f-d45ebb35f47f">
<span class="eqno">(8.2)<a class="headerlink" href="#equation-a8658c21-2c86-4c64-848f-d45ebb35f47f" title="Permalink to this equation">#</a></span>\[\begin{equation}
S \perp U
\end{equation}\]</div>
<p>We would still need SUTVA and perfect compliance (compliance with the natural process of assigning treatment). Then, everything else follows from the process of estimating effects from experiments.</p>
<p>The challenge here is to identify what dataset and what causal question constitutes a natural experiment.</p>
<ul class="simple">
<li><p>In class, we see that we can ask how winning lotteries affects spending.</p></li>
<li><p>Similarly, other examples include asking how military service will affect lifetime earnings (given that it is through draft lottery).</p></li>
<li><p>More?</p></li>
</ul>
<section id="random-v-s-non-random-assignment">
<h3><span class="section-number">8.2.1. </span>Random v.s. Non-random Assignment<a class="headerlink" href="#random-v-s-non-random-assignment" title="Link to this heading">#</a></h3>
<p>First, we can see what random assignment v.s. non-random assignment looks like through the following example.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># simulating random treatment assignment</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">201</span><span class="p">)</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">treatment</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<span class="n">data_random</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;treatment&#39;</span><span class="p">:</span> <span class="n">treatment</span><span class="p">,</span>
    <span class="s1">&#39;outcome&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">treatment</span>
<span class="p">})</span>

<span class="c1"># non-random treatment assignment based on a confounder</span>
<span class="n">confounder</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<span class="n">treatment</span> <span class="o">=</span> <span class="p">(</span><span class="n">confounder</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="c1"># treatment based on signs of U</span>
<span class="n">data_non_random</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;confounder&#39;</span><span class="p">:</span> <span class="n">confounder</span><span class="p">,</span>
    <span class="s1">&#39;treatment&#39;</span><span class="p">:</span> <span class="n">treatment</span><span class="p">,</span>
    <span class="s1">&#39;outcome&#39;</span><span class="p">:</span> <span class="n">confounder</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">treatment</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<span class="p">})</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Random assignment&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data_random</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Non-random assignment&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data_non_random</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Random assignment
   treatment   outcome
0          0  0.208307
1          1  1.365955
2          1  0.343714
3          1  0.916081
4          1  0.350137
5          0  0.383980
6          0  0.292093
7          0  1.160619
8          0 -0.296647
9          0 -0.679880
Non-random assignment
   confounder  treatment   outcome
0   -0.125056          0 -1.547934
1    1.496612          1  3.965643
2    0.220468          1  2.315961
3    0.011191          1  1.991408
4   -0.378124          0  0.156474
5   -2.436663          0 -2.242509
6    0.223760          1  2.870007
7   -0.553656          0  1.051514
8    0.048394          1  1.850523
9    0.226738          1  3.058482
</pre></div>
</div>
</div>
</div>
<p>Will the second example pass the balance test?</p>
<div class="amsmath math notranslate nohighlight" id="equation-bad88647-8aa6-4a9f-b0b3-8dbdab11b0ff">
<span class="eqno">(8.3)<a class="headerlink" href="#equation-bad88647-8aa6-4a9f-b0b3-8dbdab11b0ff" title="Permalink to this equation">#</a></span>\[\begin{equation}
p(U|S=1) = p(U|S=0)
\end{equation}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># distributions of confounder given treatment</span>
<span class="n">data_non_random</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;treatment&#39;</span><span class="p">)[</span><span class="s1">&#39;confounder&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>treatment
0    Axes(0.125,0.11;0.775x0.77)
1    Axes(0.125,0.11;0.775x0.77)
Name: confounder, dtype: object
</pre></div>
</div>
<img alt="../_images/a2552a367671b65399f7a71cf01e9e23fb20774ea1184d7bc64ed38e90c0835d.png" src="../_images/a2552a367671b65399f7a71cf01e9e23fb20774ea1184d7bc64ed38e90c0835d.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">data_non_random</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;treatment&#39;</span><span class="p">)[</span><span class="s1">&#39;confounder&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>treatment
0   -0.856284
1    0.829128
Name: confounder, dtype: float64
</pre></div>
</div>
</div>
</div>
</section>
<section id="case-study-dutch-postcode-lottery">
<h3><span class="section-number">8.2.2. </span>Case Study: Dutch Postcode Lottery<a class="headerlink" href="#case-study-dutch-postcode-lottery" title="Link to this heading">#</a></h3>
<p>A famous natural experiment is the Dutch Postcode Lottery. In this lottery, neighborhoods (postal codes) are chosen at random, and everyone in the chosen postal code wins some amount of money.</p>
<p>This creates an “as-if” random treatment group (winners) and a control group (non-winners), allowing us to estimate the causal effect of winning the lottery on spending behavior.</p>
<p>Take-home Exercise: Download the real data file <code class="docutils literal notranslate"><span class="pre">FinalAnon.dta</span></code> from https://www.aeaweb.org/articles?id=10.1257/aer.101.5.2226, and run the following code sample from class. Recreate the balance test!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="nn">sm</span>

<span class="n">lotto</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_stata</span><span class="p">(</span><span class="s1">&#39;FinalAnon.dta&#39;</span><span class="p">)</span>
<span class="n">lotto</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">lotto</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_stata</span><span class="p">(</span><span class="s1">&#39;FinalAnon.dta&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">lotto</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;statsmodels&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dur_est</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="s1">&#39;durable_spending~win_code&#39;</span><span class="p">,</span>
<span class="n">data</span><span class="o">=</span><span class="n">lotto</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">cov_type</span> <span class="o">=</span> <span class="s1">&#39;cluster&#39;</span><span class="p">,</span>
<span class="n">cov_kwds</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;groups&#39;</span><span class="p">:</span> <span class="n">lotto</span><span class="p">[</span><span class="s1">&#39;pstk&#39;</span><span class="p">]})</span>
<span class="n">dur_est</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>    <td>durable_spending</td> <th>  R-squared:         </th> <td>   0.000</td> 
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th> <td>  -0.000</td> 
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th> <td>  0.4357</td> 
</tr>
<tr>
  <th>Date:</th>             <td>Thu, 17 Oct 2024</td> <th>  Prob (F-statistic):</th>  <td> 0.510</td>  
</tr>
<tr>
  <th>Time:</th>                 <td>13:12:39</td>     <th>  Log-Likelihood:    </th> <td> -18342.</td> 
</tr>
<tr>
  <th>No. Observations:</th>      <td>  1879</td>      <th>  AIC:               </th> <td>3.669e+04</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td>  1877</td>      <th>  BIC:               </th> <td>3.670e+04</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     1</td>      <th>                     </th>     <td> </td>    
</tr>
<tr>
  <th>Covariance Type:</th>       <td>cluster</td>     <th>                     </th>     <td> </td>    
</tr>
</table>
<table class="simpletable">
<tr>
      <td></td>         <th>coef</th>     <th>std err</th>      <th>z</th>      <th>P>|z|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th> <td>  768.2129</td> <td>  138.482</td> <td>    5.547</td> <td> 0.000</td> <td>  496.792</td> <td> 1039.633</td>
</tr>
<tr>
  <th>win_code</th>  <td>  119.0228</td> <td>  180.316</td> <td>    0.660</td> <td> 0.509</td> <td> -234.390</td> <td>  472.436</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td>4215.181</td> <th>  Durbin-Watson:     </th>   <td>   2.004</td>  
</tr>
<tr>
  <th>Prob(Omnibus):</th>  <td> 0.000</td>  <th>  Jarque-Bera (JB):  </th> <td>28242902.362</td>
</tr>
<tr>
  <th>Skew:</th>           <td>20.149</td>  <th>  Prob(JB):          </th>   <td>    0.00</td>  
</tr>
<tr>
  <th>Kurtosis:</th>       <td>602.263</td> <th>  Cond. No.          </th>   <td>    2.43</td>  
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors are robust to cluster correlation (cluster)</div></div>
</div>
<p>Since you will need to agree to the data terms for using the real dataset, we will replicate a simplified version of it here through simulated data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># simulating the Dutch Postcode Lottery example</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">201</span><span class="p">)</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="n">postcode</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<span class="c1"># select 10 random postcodes to be past winners</span>
<span class="n">winners</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">postcode</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">lottery</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">postcode</span><span class="p">,</span> <span class="n">winners</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;postcode&#39;</span><span class="p">:</span> <span class="n">postcode</span><span class="p">,</span>
    <span class="s1">&#39;lottery&#39;</span><span class="p">:</span> <span class="n">lottery</span><span class="p">,</span>
    <span class="s1">&#39;spending&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
<span class="p">})</span>

<span class="c1"># lottery winners spend more - causal effect</span>
<span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;lottery&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;spending&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">600</span>

<span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-cee89ea9-0774-4e06-a0f1-039102e3b9d0" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>postcode</th>
      <th>lottery</th>
      <th>spending</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0</td>
      <td>390.602612</td>
    </tr>
    <tr>
      <th>1</th>
      <td>42</td>
      <td>0</td>
      <td>121.182831</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>0</td>
      <td>564.648987</td>
    </tr>
    <tr>
      <th>3</th>
      <td>34</td>
      <td>0</td>
      <td>1497.473539</td>
    </tr>
    <tr>
      <th>4</th>
      <td>37</td>
      <td>0</td>
      <td>313.040010</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>995</th>
      <td>34</td>
      <td>0</td>
      <td>486.917288</td>
    </tr>
    <tr>
      <th>996</th>
      <td>2</td>
      <td>0</td>
      <td>1179.313425</td>
    </tr>
    <tr>
      <th>997</th>
      <td>13</td>
      <td>0</td>
      <td>1613.079625</td>
    </tr>
    <tr>
      <th>998</th>
      <td>28</td>
      <td>0</td>
      <td>331.047279</td>
    </tr>
    <tr>
      <th>999</th>
      <td>18</td>
      <td>0</td>
      <td>882.604579</td>
    </tr>
  </tbody>
</table>
<p>1000 rows × 3 columns</p>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-cee89ea9-0774-4e06-a0f1-039102e3b9d0')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-cee89ea9-0774-4e06-a0f1-039102e3b9d0 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-cee89ea9-0774-4e06-a0f1-039102e3b9d0');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-c7a26a84-245a-4cb7-a5a2-b1a342dc6b86">
  <button class="colab-df-quickchart" onclick="quickchart('df-c7a26a84-245a-4cb7-a5a2-b1a342dc6b86')"
            title="Suggest charts"
            style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-c7a26a84-245a-4cb7-a5a2-b1a342dc6b86 button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

  <div id="id_fea594de-cc84-444f-a9d2-ffa1f669f671">
    <style>
      .colab-df-generate {
        background-color: #E8F0FE;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: none;
        fill: #1967D2;
        height: 32px;
        padding: 0 0 0 0;
        width: 32px;
      }

      .colab-df-generate:hover {
        background-color: #E2EBFA;
        box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
        fill: #174EA6;
      }

      [theme=dark] .colab-df-generate {
        background-color: #3B4455;
        fill: #D2E3FC;
      }

      [theme=dark] .colab-df-generate:hover {
        background-color: #434B5C;
        box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
        filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
        fill: #FFFFFF;
      }
    </style>
    <button class="colab-df-generate" onclick="generateWithVariable('data')"
            title="Generate code using this dataframe."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M7,19H8.4L18.45,9,17,7.55,7,17.6ZM5,21V16.75L18.45,3.32a2,2,0,0,1,2.83,0l1.4,1.43a1.91,1.91,0,0,1,.58,1.4,1.91,1.91,0,0,1-.58,1.4L9.25,21ZM18.45,9,17,7.55Zm-12,3A5.31,5.31,0,0,0,4.9,8.1,5.31,5.31,0,0,0,1,6.5,5.31,5.31,0,0,0,4.9,4.9,5.31,5.31,0,0,0,6.5,1,5.31,5.31,0,0,0,8.1,4.9,5.31,5.31,0,0,0,12,6.5,5.46,5.46,0,0,0,6.5,12Z"/>
  </svg>
    </button>
    <script>
      (() => {
      const buttonEl =
        document.querySelector('#id_fea594de-cc84-444f-a9d2-ffa1f669f671 button.colab-df-generate');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      buttonEl.onclick = () => {
        google.colab.notebook.generateWithVariable('data');
      }
      })();
    </script>
  </div>

    </div>
  </div>
</div></div>
</div>
<p>Now, we have learned two methods for estimating the effects after identifying the causal parameters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ATE through conditional expectations</span>
<span class="n">ATE_spending</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;lottery&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">][</span><span class="s1">&#39;spending&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;lottery&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">][</span><span class="s1">&#39;spending&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ATE through conditional expectations: </span><span class="si">{</span><span class="n">ATE_spending</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ATE through conditional expectations: 626.7861219199798
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># regress spending on winning</span>
<span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="s1">&#39;spending ~ lottery&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">results</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>        <td>spending</td>     <th>  R-squared:         </th> <td>   0.217</td> 
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th> <td>   0.216</td> 
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th> <td>   276.1</td> 
</tr>
<tr>
  <th>Date:</th>             <td>Thu, 17 Oct 2024</td> <th>  Prob (F-statistic):</th> <td>6.45e-55</td> 
</tr>
<tr>
  <th>Time:</th>                 <td>22:35:13</td>     <th>  Log-Likelihood:    </th> <td> -7591.4</td> 
</tr>
<tr>
  <th>No. Observations:</th>      <td>  1000</td>      <th>  AIC:               </th> <td>1.519e+04</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td>   998</td>      <th>  BIC:               </th> <td>1.520e+04</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     1</td>      <th>                     </th>     <td> </td>    
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>     <td> </td>    
</tr>
</table>
<table class="simpletable">
<tr>
      <td></td>         <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th> <td> 1022.4238</td> <td>   16.997</td> <td>   60.154</td> <td> 0.000</td> <td>  989.070</td> <td> 1055.777</td>
</tr>
<tr>
  <th>lottery</th>   <td>  626.7861</td> <td>   37.724</td> <td>   16.615</td> <td> 0.000</td> <td>  552.759</td> <td>  700.814</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td> 9.492</td> <th>  Durbin-Watson:     </th> <td>   1.942</td>
</tr>
<tr>
  <th>Prob(Omnibus):</th> <td> 0.009</td> <th>  Jarque-Bera (JB):  </th> <td>   9.379</td>
</tr>
<tr>
  <th>Skew:</th>          <td> 0.213</td> <th>  Prob(JB):          </th> <td> 0.00919</td>
</tr>
<tr>
  <th>Kurtosis:</th>      <td> 2.790</td> <th>  Cond. No.          </th> <td>    2.61</td>
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># with clustered error</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="s1">&#39;spending ~ lottery&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">cov_type</span><span class="o">=</span><span class="s1">&#39;cluster&#39;</span><span class="p">,</span> <span class="n">cov_kwds</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;groups&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;postcode&#39;</span><span class="p">]})</span>
<span class="n">results</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>        <td>spending</td>     <th>  R-squared:         </th> <td>   0.217</td> 
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th> <td>   0.216</td> 
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th> <td>   433.5</td> 
</tr>
<tr>
  <th>Date:</th>             <td>Thu, 17 Oct 2024</td> <th>  Prob (F-statistic):</th> <td>1.12e-25</td> 
</tr>
<tr>
  <th>Time:</th>                 <td>22:35:17</td>     <th>  Log-Likelihood:    </th> <td> -7591.4</td> 
</tr>
<tr>
  <th>No. Observations:</th>      <td>  1000</td>      <th>  AIC:               </th> <td>1.519e+04</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td>   998</td>      <th>  BIC:               </th> <td>1.520e+04</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     1</td>      <th>                     </th>     <td> </td>    
</tr>
<tr>
  <th>Covariance Type:</th>       <td>cluster</td>     <th>                     </th>     <td> </td>    
</tr>
</table>
<table class="simpletable">
<tr>
      <td></td>         <th>coef</th>     <th>std err</th>      <th>z</th>      <th>P>|z|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th> <td> 1022.4238</td> <td>   15.953</td> <td>   64.092</td> <td> 0.000</td> <td>  991.157</td> <td> 1053.690</td>
</tr>
<tr>
  <th>lottery</th>   <td>  626.7861</td> <td>   30.105</td> <td>   20.820</td> <td> 0.000</td> <td>  567.782</td> <td>  685.790</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td> 9.492</td> <th>  Durbin-Watson:     </th> <td>   1.942</td>
</tr>
<tr>
  <th>Prob(Omnibus):</th> <td> 0.009</td> <th>  Jarque-Bera (JB):  </th> <td>   9.379</td>
</tr>
<tr>
  <th>Skew:</th>          <td> 0.213</td> <th>  Prob(JB):          </th> <td> 0.00919</td>
</tr>
<tr>
  <th>Kurtosis:</th>      <td> 2.790</td> <th>  Cond. No.          </th> <td>    2.61</td>
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors are robust to cluster correlation (cluster)</div></div>
</div>
<p>We would need to provide evidence for the independence assumptions for the observed characteristics. For the real dataset, this includes demographics, family income… Note: this would only apply to the population who participated in the lottery regularly. If we extend it to the general population, we could see, e.g., very different demographics between these who partipate in lotteries and those who don’t.</p>
<p>However, this does not eliminate unobserved confounding.</p>
</section>
</section>
<section id="control-variables-preview-and-review">
<h2><span class="section-number">8.3. </span>Control Variables (Preview) and Review<a class="headerlink" href="#control-variables-preview-and-review" title="Link to this heading">#</a></h2>
<p>PSA: control variables will not be on the midterm, and we will cover more on it after the midterm.</p>
<p>If the data-generating processes were not naturally randomizing treatment, we can seek to adjust the population in the treatment and control groups.</p>
<p>One adjustment method is through controlling or conditioning on other factors $C$ such that</p>
<div class="amsmath math notranslate nohighlight" id="equation-53ffbb94-0ad4-4eab-baa6-1ad2e6a29d4c">
<span class="eqno">(8.4)<a class="headerlink" href="#equation-53ffbb94-0ad4-4eab-baa6-1ad2e6a29d4c" title="Permalink to this equation">#</a></span>\[\begin{equation}
S \perp U \ | \ C
\end{equation}\]</div>
<p>In this case, we can say that $S$ and $U$ are <strong>conditionally independent</strong> given $C$.</p>
<section id="independence-recap">
<h3><span class="section-number">8.3.1. </span>2.1 Independence Recap<a class="headerlink" href="#independence-recap" title="Link to this heading">#</a></h3>
<p>Independence plays a central role in our arguments for the identification of causal parameters.</p>
<p>$$
P(X \in A, Y \in B) = P(X \in A)P(Y \in B)
$$</p>
<p>Also,</p>
<p>$$
P(Y|X) = P(Y) \ \ \text{and} \ \ P(X|Y) = P(X)
$$</p>
<p>If two variables are independent, then knowing the value of one variable does not provide additional information about the other.</p>
<p>Also, independent variables have a covariance of 0 and are, therefore, uncorrelated.</p>
<ul class="simple">
<li><p>Proof in lecture slides by showing $E[XY]=E[X]E[Y]$</p></li>
</ul>
<p>We’ve seen that independence implies 0 covariance and uncorrelatedness.</p>
<p>However, the converse statement is false. Independence is not necessary for uncorrelatedness.</p>
</section>
<section id="conditional-independence">
<h3><span class="section-number">8.3.2. </span>2.2 Conditional Independence<a class="headerlink" href="#conditional-independence" title="Link to this heading">#</a></h3>
<p>$$
P(X \in A, Y \in B | Z) = P(X \in A|Z)P(Y \in B|Z)
$$</p>
<p>Also,</p>
<p>$$
P(Y|X, Z) = P(Y|Z) \ \ \text{and} \ \ P(X|Y, Z) = P(X | Z)
$$</p>
<p>$X$ and $Y$ have no relationship if we account for the value taken by some other variable $Z$. For example, knowing $X$, if we already know $Z$, this does not influence our estimate of $Y$.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># simulate independent random variables</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">201</span><span class="p">)</span>
<span class="n">X_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>  <span class="c1"># Roll of die 1</span>
<span class="n">Y_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>  <span class="c1"># Roll of die 2</span>

<span class="c1"># calculate covariance of independent variables</span>
<span class="n">cov_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">X_ind</span><span class="p">,</span> <span class="n">Y_ind</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Covariance of independent variables: </span><span class="si">{</span><span class="n">cov_ind</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># simulate dependent variables</span>
<span class="n">X_dep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">Y_dep</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">X_dep</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">Z_dep</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">X_dep</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

<span class="c1"># calculate covariance of dependent variables</span>
<span class="n">cov_dep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">Y_dep</span><span class="p">,</span> <span class="n">Z_dep</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Covariance of dependent variables Y and Z: </span><span class="si">{</span><span class="n">cov_dep</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># calculate covariance of dependent variables condition on X</span>
<span class="k">for</span> <span class="n">X_value</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
  <span class="n">cov_dep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">Y_dep</span><span class="p">[</span><span class="n">X_dep</span><span class="o">==</span><span class="n">X_value</span><span class="p">],</span> <span class="n">Z_dep</span><span class="p">[</span><span class="n">X_dep</span><span class="o">==</span><span class="n">X_value</span><span class="p">])[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Covariance of dependent variables Y and Z condition on X = </span><span class="si">{</span><span class="n">X_value</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">cov_dep</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Covariance of independent variables: -0.09712712712712727
Covariance of dependent variables Y and Z: 25.55082953533942
Covariance of dependent variables Y and Z condition on X = 1: -0.16950780028113066
Covariance of dependent variables Y and Z condition on X = 2: -0.2008651282600672
Covariance of dependent variables Y and Z condition on X = 3: -0.039116306498144265
Covariance of dependent variables Y and Z condition on X = 4: 0.12289574759251388
Covariance of dependent variables Y and Z condition on X = 5: -0.021864156396484553
Covariance of dependent variables Y and Z condition on X = 6: -0.022540072239564873
Covariance of dependent variables Y and Z condition on X = 7: -0.051055281115317146
Covariance of dependent variables Y and Z condition on X = 8: -0.1343325234297629
Covariance of dependent variables Y and Z condition on X = 9: -0.09652086587770842
</pre></div>
</div>
</div>
</div>
<p>Graphically, what does conditional independence look like?</p>
<p><img alt="Indep" src="https://www.researchgate.net/publication/306006513/figure/fig1/AS:393236871958528&#64;1470766384078/Cases-for-d-connectivity-and-d-separation-Black-gray-circles-mean-that-evidence-is.png" /></p>
<p>For more intuitive examples, feel free to check out https://www.andrew.cmu.edu/user/scheines/tutor/d-sep.html</p>
</section>
<section id="revisiting-revisiting-all-causes-model">
<h3><span class="section-number">8.3.3. </span>Revisiting -  Revisiting All Causes Model<a class="headerlink" href="#revisiting-revisiting-all-causes-model" title="Link to this heading">#</a></h3>
<p>We have actually covered control variables in Lab 3 if you remember.</p>
<p>Let’s review some old concepts and revisit the example again with our new knowledge on regression and experiments.</p>
<section id="definition">
<h4><span class="section-number">8.3.3.1. </span>Definition<a class="headerlink" href="#definition" title="Link to this heading">#</a></h4>
<p>All causes model:</p>
<p>$$Y(S, U)$$</p>
<p>where $Y$ is the outcome, $S$ is the state of the world, and $U$ is other factors we observe that influence $Y$.</p>
<p>Also, for simplicity, consider $S$ as a binary treatment variable (0 or 1).</p>
<p>Causal quantities of interest:</p>
<p>$$</p>
<div class="amsmath math notranslate nohighlight" id="equation-b5697549-f0f0-43e7-a39c-bf44f045d589">
<span class="eqno">(8.5)<a class="headerlink" href="#equation-b5697549-f0f0-43e7-a39c-bf44f045d589" title="Permalink to this equation">#</a></span>\[\begin{align}
\text{ATE} &amp;= E[Y(S=1, U) - Y(S=0, U)]\\
\text{ATT} &amp;= E[Y(S=1, U) - Y(S=0, U)|S=1]\\
\text{ATU} &amp;= E[Y(S=1, U) - Y(S=0, U)|S=0]
\end{align}\]</div>
<p>$$</p>
<p><strong>Fundamental problem of causal inference</strong>: we only get to see one of $Y(S=1, U)$ and $Y(S=0, U)$.</p>
<p>Identification is the process where we reduce these equations involving unobserved variables to observed data.</p>
</section>
<section id="simulation">
<h4><span class="section-number">8.3.3.2. </span>2.3.2 Simulation<a class="headerlink" href="#simulation" title="Link to this heading">#</a></h4>
<p>Using the old example, we will show how computing only association based on observational data does not give us the true underlying causal effect, and how <em>control variables</em> can help us identify these parameters.</p>
<ul class="simple">
<li><p>$Y$ is continuous income.</p></li>
<li><p>$S$ is binary college status. (1 = went to college)</p></li>
<li><p>$U$ is binary family status. (1 = wealthy family)</p></li>
</ul>
<p>We can see that the true causal effect from college status to income of people will be confounded by the third variable on family status as it is a common cause of both the treatment and outcome, i.e., a wealthy family leads to higher income and more likely to go to college.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>


<span class="c1"># Create a directed graph</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>

<span class="c1"># Add nodes</span>
<span class="n">G</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;Family Status (U)&quot;</span><span class="p">)</span>
<span class="n">G</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;College (S)&quot;</span><span class="p">)</span>
<span class="n">G</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;Income (Y)&quot;</span><span class="p">)</span>

<span class="c1"># Add directed edges representing causal relationships</span>
<span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;Family Status (U)&quot;</span><span class="p">,</span> <span class="s2">&quot;College (S)&quot;</span><span class="p">)</span>
<span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;Family Status (U)&quot;</span><span class="p">,</span> <span class="s2">&quot;Income (Y)&quot;</span><span class="p">)</span>
<span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;College (S)&quot;</span><span class="p">,</span> <span class="s2">&quot;Income (Y)&quot;</span><span class="p">)</span>

<span class="c1"># Draw the graph</span>
<span class="n">pos</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Family Status (U)&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="s2">&quot;College (S)&quot;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="s2">&quot;Income (Y)&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<span class="p">}</span>

<span class="n">labels</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">(</span><span class="s2">&quot;Family Status (U)&quot;</span><span class="p">,</span> <span class="s2">&quot;College (S)&quot;</span><span class="p">):</span> <span class="s2">&quot;Positive&quot;</span><span class="p">,</span>
    <span class="p">(</span><span class="s2">&quot;Family Status (U)&quot;</span><span class="p">,</span> <span class="s2">&quot;Income (Y)&quot;</span><span class="p">):</span> <span class="s2">&quot;Positive&quot;</span><span class="p">,</span>
    <span class="p">(</span><span class="s2">&quot;College (S)&quot;</span><span class="p">,</span> <span class="s2">&quot;Income (Y)&quot;</span><span class="p">):</span> <span class="s2">&quot;Positive&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="s2">&quot;lightblue&quot;</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">font_weight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span> <span class="n">arrows</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edge_labels</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">edge_labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">font_color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/7c96097eebf3c6c4f8b559f1ce436ddd1097c08c7d1a5a701e30038057e2f564.png" src="../_images/7c96097eebf3c6c4f8b559f1ce436ddd1097c08c7d1a5a701e30038057e2f564.png" />
</div>
</div>
<p>Now, let’s generate some sythetic data corresponding to this data generative process.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Step 1: Simulate family status (rich=1, poor=0)</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">family_status</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>  <span class="c1"># 40% rich, 60% poor</span>

<span class="c1"># Step 2: Simulate college attendance based on family status (rich more likely to attend college)</span>
<span class="n">college</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.7</span> <span class="o">*</span> <span class="n">family_status</span> <span class="o">+</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">family_status</span><span class="p">),</span> <span class="n">n</span><span class="p">)</span>

<span class="c1"># Step 3: Simulate income based on family status and college attendance</span>

<span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>  <span class="c1"># Noise to add to income</span>
<span class="n">income_observe</span> <span class="o">=</span> <span class="p">(</span><span class="mi">50000</span> <span class="o">+</span> <span class="mi">30000</span> <span class="o">*</span> <span class="n">college</span> <span class="o">+</span> <span class="mi">20000</span> <span class="o">*</span> <span class="n">family_status</span> <span class="o">+</span> <span class="n">noise</span><span class="p">)</span>
<span class="n">income_college</span> <span class="o">=</span> <span class="p">(</span><span class="mi">50000</span> <span class="o">+</span> <span class="mi">30000</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">20000</span> <span class="o">*</span> <span class="n">family_status</span> <span class="o">+</span> <span class="n">noise</span><span class="p">)</span>

<span class="c1"># For people who went to college (treated group), compared to the untreated,</span>
<span class="c1"># they would have higher income in the counterfactual world where they did not go to college</span>
<span class="n">income_no_college</span> <span class="o">=</span> <span class="p">(</span><span class="mi">50000</span> <span class="o">+</span> <span class="mi">30000</span> <span class="o">*</span> <span class="mi">0</span> <span class="o">+</span> <span class="mi">10000</span> <span class="o">*</span> <span class="n">college</span> <span class="o">+</span> <span class="mi">20000</span> <span class="o">*</span> <span class="n">family_status</span> <span class="o">+</span> <span class="n">noise</span><span class="p">)</span>

<span class="c1"># Create a DataFrame for clarity</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Family_Status&#39;</span><span class="p">:</span> <span class="n">family_status</span><span class="p">,</span>  <span class="c1"># 1 = rich, 0 = poor</span>
    <span class="s1">&#39;College&#39;</span><span class="p">:</span> <span class="n">college</span><span class="p">,</span>  <span class="c1"># 1 = went to college, 0 = did not go to college</span>
    <span class="s1">&#39;Income_Observe&#39;</span><span class="p">:</span> <span class="n">income_observe</span><span class="p">,</span>
    <span class="s1">&#39;Income_College&#39;</span><span class="p">:</span> <span class="n">income_college</span><span class="p">,</span>
    <span class="s1">&#39;Income_No_College&#39;</span><span class="p">:</span> <span class="n">income_no_college</span>
<span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<p>We can calculate the true ATE, ATT, and ATU based on the perfect knowledge we have on the observed and conuterfactual outcomes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Step 4: Compute ATE, ATT, ATU</span>
<span class="c1"># TRUE ATE:</span>
<span class="n">ATE</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Income_College&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Income_No_College&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c1"># ATT:</span>
<span class="n">ATT</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;College&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)][</span><span class="s1">&#39;Income_College&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;College&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)][</span><span class="s1">&#39;Income_No_College&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c1"># ATU:</span>
<span class="n">ATU</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;College&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)][</span><span class="s1">&#39;Income_College&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;College&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)][</span><span class="s1">&#39;Income_No_College&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c1"># Print the results</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TRUE Average Treatment Effect (ATE): </span><span class="si">{</span><span class="n">ATE</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TRUE Average Treatment Effect on the Treated (ATT): </span><span class="si">{</span><span class="n">ATT</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TRUE Average Treatment Effect on the Untreated (ATU): </span><span class="si">{</span><span class="n">ATU</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TRUE Average Treatment Effect (ATE): 25560.00
TRUE Average Treatment Effect on the Treated (ATT): 20000.00
TRUE Average Treatment Effect on the Untreated (ATU): 30000.00
</pre></div>
</div>
</div>
</div>
<p>What happens if we only have access to the observed treatment and outcome with hidden confounding?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Step 5: Compute association by conditioning</span>
<span class="c1"># Biased ATE using only what was obserevd:</span>
<span class="n">Association</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;College&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Income_Observe&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;College&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Income_Observe&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c1"># Print the results</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Biased Average Treatment Effect (ATE): </span><span class="si">{</span><span class="n">Association</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Biased Average Treatment Effect (ATE): 37639.89
</pre></div>
</div>
</div>
</div>
<p>If we have access to potential confounders, we can condition them. Conditional independence helps us here to establish the assumption.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Step 6: Condition on confounder - family status</span>

<span class="n">Association</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;College&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Family_Status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)][</span><span class="s1">&#39;Income_Observe&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;College&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Family_Status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)][</span><span class="s1">&#39;Income_Observe&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c1"># Print the results</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Association for those with family_status = 1: </span><span class="si">{</span><span class="n">Association</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">Association</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;College&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Family_Status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)][</span><span class="s1">&#39;Income_Observe&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;College&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Family_Status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)][</span><span class="s1">&#39;Income_Observe&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c1"># Print the results</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Association for those with family_status = 0: </span><span class="si">{</span><span class="n">Association</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Association for those with family_status = 1: 30553.75
Association for those with family_status = 0: 30308.08
</pre></div>
</div>
</div>
</div>
<p>Without adding the confounder to our regression setup, the result is biased similar to the conditional expectation without conditioning on the confounder.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="nn">sm</span>

<span class="n">ols</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="s1">&#39;Income_Observe~College&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">ols</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>     <td>Income_Observe</td>  <th>  R-squared:         </th> <td>   0.771</td> 
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th> <td>   0.771</td> 
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th> <td>   3357.</td> 
</tr>
<tr>
  <th>Date:</th>             <td>Thu, 17 Oct 2024</td> <th>  Prob (F-statistic):</th> <td>1.55e-321</td>
</tr>
<tr>
  <th>Time:</th>                 <td>22:37:09</td>     <th>  Log-Likelihood:    </th> <td> -10649.</td> 
</tr>
<tr>
  <th>No. Observations:</th>      <td>  1000</td>      <th>  AIC:               </th> <td>2.130e+04</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td>   998</td>      <th>  BIC:               </th> <td>2.131e+04</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     1</td>      <th>                     </th>     <td> </td>    
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>     <td> </td>    
</tr>
</table>
<table class="simpletable">
<tr>
      <td></td>         <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th> <td> 5.441e+04</td> <td>  432.902</td> <td>  125.692</td> <td> 0.000</td> <td> 5.36e+04</td> <td> 5.53e+04</td>
</tr>
<tr>
  <th>College</th>   <td> 3.764e+04</td> <td>  649.679</td> <td>   57.936</td> <td> 0.000</td> <td> 3.64e+04</td> <td> 3.89e+04</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td>72.502</td> <th>  Durbin-Watson:     </th> <td>   1.953</td>
</tr>
<tr>
  <th>Prob(Omnibus):</th> <td> 0.000</td> <th>  Jarque-Bera (JB):  </th> <td>  30.972</td>
</tr>
<tr>
  <th>Skew:</th>          <td> 0.209</td> <th>  Prob(JB):          </th> <td>1.88e-07</td>
</tr>
<tr>
  <th>Kurtosis:</th>      <td> 2.246</td> <th>  Cond. No.          </th> <td>    2.51</td>
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</div></div>
</div>
<p>We can only identify it by adding the confounder to establish conditional independence.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ols</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="s1">&#39;Income_Observe~College+Family_Status&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">ols</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>     <td>Income_Observe</td>  <th>  R-squared:         </th> <td>   0.947</td> 
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th> <td>   0.947</td> 
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th> <td>   8981.</td> 
</tr>
<tr>
  <th>Date:</th>             <td>Thu, 17 Oct 2024</td> <th>  Prob (F-statistic):</th>  <td>  0.00</td>  
</tr>
<tr>
  <th>Time:</th>                 <td>22:37:15</td>     <th>  Log-Likelihood:    </th> <td> -9912.8</td> 
</tr>
<tr>
  <th>No. Observations:</th>      <td>  1000</td>      <th>  AIC:               </th> <td>1.983e+04</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td>   997</td>      <th>  BIC:               </th> <td>1.985e+04</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     2</td>      <th>                     </th>     <td> </td>    
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>     <td> </td>    
</tr>
</table>
<table class="simpletable">
<tr>
        <td></td>           <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th>     <td> 4.996e+04</td> <td>  221.278</td> <td>  225.780</td> <td> 0.000</td> <td> 4.95e+04</td> <td> 5.04e+04</td>
</tr>
<tr>
  <th>College</th>       <td> 3.041e+04</td> <td>  335.519</td> <td>   90.623</td> <td> 0.000</td> <td> 2.97e+04</td> <td> 3.11e+04</td>
</tr>
<tr>
  <th>Family_Status</th> <td>  1.98e+04</td> <td>  342.263</td> <td>   57.864</td> <td> 0.000</td> <td> 1.91e+04</td> <td> 2.05e+04</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td> 1.170</td> <th>  Durbin-Watson:     </th> <td>   2.050</td>
</tr>
<tr>
  <th>Prob(Omnibus):</th> <td> 0.557</td> <th>  Jarque-Bera (JB):  </th> <td>   1.054</td>
</tr>
<tr>
  <th>Skew:</th>          <td> 0.025</td> <th>  Prob(JB):          </th> <td>   0.590</td>
</tr>
<tr>
  <th>Kurtosis:</th>      <td> 3.151</td> <th>  Cond. No.          </th> <td>    3.09</td>
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</div></div>
</div>
</section>
</section>
</section>
<section id="other-topics-for-midterm">
<h2><span class="section-number">8.4. </span>3. Other Topics for Midterm<a class="headerlink" href="#other-topics-for-midterm" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>(Conditional/Joint) Distribution</p></li>
<li><p>Expectation</p></li>
<li><p>Variance</p></li>
<li><p>LIE</p></li>
<li><p>WLLN</p></li>
<li><p>CLT</p></li>
<li><p>hypothesis testing</p></li>
<li><p>p-value</p></li>
<li><p>confidence interval</p></li>
<li><p>experiment</p></li>
<li><p>(descriptive/causal) (simple/multiple) linear regression</p></li>
</ul>
<p>How are these things related to causality (e.g., identification and estimation)? What assumptions did we make?</p>
<p>For instance, LIE was used frequently in some of the derivations on identifiability for causal (multiple) linear regression.</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
E[V] &amp;= E[U - E[U | S, C]] \\
     &amp;= E[U] - E[E[U | S, C]] \\
     &amp;= E[U] - E[U] \quad (\text{LIE})\\
     &amp;= 0
\end{align*}\]</div>
<p>and</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
E[VS] &amp;= E\left[(U - E[U | S, C]) S \right] \\
      &amp;= E[US - E[U | S, C] S] \\
      &amp;= E[US] - E[E[US | S, C]] \\
      &amp;= E[US] - E[US] \quad (\text{LIE}) \\
      &amp;= 0
\end{align*}\]</div>
<p>Review session on Monday.</p>
</section>
<section id="good-luck-on-your-midterm-next-week">
<h2><span class="section-number">8.5. </span>Good luck on your midterm next week!<a class="headerlink" href="#good-luck-on-your-midterm-next-week" title="Link to this heading">#</a></h2>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./sections"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="6_Regression_1-2.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">7. </span>Regression</p>
      </div>
    </a>
    <a class="right-next"
       href="8_ML_and_Causality.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">9. </span>The Interplay between Machine Learning and Causal Inference</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#causality-from-observational-data">8.1. Causality from Observational Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">8.2. 1. Natural Experiments</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#random-v-s-non-random-assignment">8.2.1. Random v.s. Non-random Assignment</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#case-study-dutch-postcode-lottery">8.2.2. Case Study: Dutch Postcode Lottery</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#control-variables-preview-and-review">8.3. Control Variables (Preview) and Review</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#independence-recap">8.3.1. 2.1 Independence Recap</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conditional-independence">8.3.2. 2.2 Conditional Independence</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#revisiting-revisiting-all-causes-model">8.3.3. Revisiting -  Revisiting All Causes Model</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#definition">8.3.3.1. Definition</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#simulation">8.3.3.2. 2.3.2 Simulation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#other-topics-for-midterm">8.4. 3. Other Topics for Midterm</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#good-luck-on-your-midterm-next-week">8.5. Good luck on your midterm next week!</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Daniela Pinto Veizaga, Xiang Pan, and Xiang Gao
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>